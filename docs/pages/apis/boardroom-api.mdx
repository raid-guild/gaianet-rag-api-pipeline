# Boardroom Governance API

This repository contains the [API pipeline manifest](https://github.com/raid-guild/gaianet-rag-api-pipeline/blob/main/config/boardroom_api_pipeline.yaml) and [OpenAPI specification](https://github.com/raid-guild/gaianet-rag-api-pipeline/blob/main/config/openapi.yaml) needed to create a RAG pipeline. This pipeline generates a knowledge base from any DAO/Protocol hosted by the Boardroom Governance API. All configuration files are located in the `config` folder.

## Prerequisites

To use this API, you'll need an API key. Request one from [Boardroom's developer portal](https://boardroom.io/developers/billing). Store the key in `config/secrets/api-key` or provide it directly using the `--api-key` CLI argument.

## API Pipeline Manifest Overview

### Basic Configuration

The manifest begins with defining the API name and parameters. This example uses the [Aave Governance DAO](https://boardroom.io/aave/insights):

```yaml
api_name: "aave_boardroom_api"

api_parameters:
  cname: "aave"
  protocol: "aave"

api_config:
  request_method: "get"
  content_type: "application/json"
  response_entrypoint_field: "data"
```

### Connector Specification

The manifest defines parameters required for API requests:

```yaml
spec:
  type: Spec
  documentation_url: https://docs.airbyte.com/integrations/sources/boardroom
  connection_specification:
    $schema: http://json-schema.org/draft-07/schema#
    title: Boardroom API Spec
    type: object
    required:
      - api_key
      - cname
      - protocol
    additionalProperties: true
    properties:
      api_key:
        type: string
        description: "Boardroom API Key. See <a href='https://docs.boardroom.io/docs/api/05c1fb6d88a07-governance-api'>here</a> for details."
        airbyte-secret: true
      cname:
        type: string
        description: "Protocol ID a.k.a cname"
        examples:
          - aave
          - hopprotocol
      protocol:
        type: string
        description: "Alias for cname. Required for endpoints using 'protocol' as parameter ID"
        examples:
          - aave
          - metacartel
```

### API Request Configuration

The `requester_base` defines how to interact with the API:

```yaml
definitions:
  requester_base:
    type: HttpRequester
    url_base: "https://api.boardroom.info/v1"
    http_method: "GET"
    authenticator:
      type: ApiKeyAuthenticator
      api_token: "{{ config['api_key'] }}"
      inject_into:
        type: RequestOption
        field_name: "key"
        inject_into: request_parameter
```

### Record Selection and Pagination

Data records are wrapped in the `data` field:

```yaml
definitions:
  selector:
    type: RecordSelector
    extractor:
      type: DpathExtractor
      field_path: ["data"]

  paginator:
    type: DefaultPaginator
    pagination_strategy:
      type: CursorPagination
      cursor_value: "{{ response.get('nextCursor', '') }}"
      stop_condition: "{{ 'nextCursor' not in response }}"
    page_token_option:
      type: RequestOption
      field_name: "cursor"
      inject_into: "request_parameter"
```

### Endpoint Configuration

Define endpoints with their respective schemas. Example for proposals endpoint:

```yaml
endpoints:
  "/protocols/{cname}/proposals":
    id: "proposals"
    primary_key: "refId"
    responseSchema: "#/schemas/Proposals"
    textSchema:
      $ref: "#/textSchemas/Proposal"
```

### Schema Definitions

The `responseSchema` defines the complete data structure:

```yaml
schemas:
  Proposals:
    type: object
    $schema: http://json-schema.org/draft-07/schema#
    properties:
      refId:
        type: string
      id:
        type: string
      title:
        type: string
      content:
        type: string
      protocol:
        type: string
      adapter:
        type: string
      proposer:
        type: string
      totalVotes:
        type: integer
      blockNumber:
        type: integer
      externalUrl:
        type: string
      startTime:
        type: object
        properties:
          timestamp:
            type: integer
      endTime:
        type: object
        properties:
          timestamp:
            type: integer
      startTimestamp:
        type: string
      endTimestamp:
        type: string
      currentState:
        type: string
      choices:
        type: array
        items:
          type: string
      results:
        type: array
        items:
          type: object
          properties:
            total:
              type: number
            choice:
              type: integer
      events:
        type: array
        items:
          type: object
          properties: {}
      type:
        type: string
      indexedResult:
        type: array
        items:
          type: object
          properties:
            total:
              type: string
            choice:
              type: string
      summary:
        type: string
      privacy:
        type: string
      indexedAt:
        type: integer
      txHash:
        type: string
      quorum:
        type: integer
```

The `textSchema` specifies fields for text parsing. Note that all properties must be listed in the `responseSchema`. In this case, `title`, `content`, and `summary` will be parsed as texts, while other fields will be included as metadata properties in a JSON object:

```yaml
textSchemas:
  Proposal:
    type: object
    properties:
      title:
        type: string
      content:
        type: string
      summary:
        type: string
```

### Chunking Parameters

Configure text chunking behavior:

```yaml
chunking_params:
  mode: "elements"
  chunking_strategy: "by_title"
  include_orig_elements: true
  max_characters: 1500
  new_after_n_chars: 1024
  overlap: 0
  overlap_all: false
  combine_text_under_n_chars: 0
  multipage_sections: true
```

## Usage Guide

### Generating a Knowledge Base

1. Ensure `Ollama` is running locally with your preferred LLM embeddings model
2. Run the following command:

```bash
poetry run rag-api-pipeline run-all config/boardroom_api_pipeline.yaml --openapi-spec-file config/openapi.yaml --llm-provider ollama
```

The processed data and knowledge base snapshot for Aave are available on [Hugging Face](https://huggingface.co/datasets/uxman/aave_snapshot_boardroom/tree/main).

### Importing into Gaianet Node

1. Locate the generated snapshot in `{OUTPUT_FOLDER}/aave_boardroom_api/` (named `aave_boardroom_api_collection-xxxxxxxxxxxxxxxx-yyyy-mm-dd-hh-mm-ss.snapshot.tar.gz`)
2. Follow the [knowledge base selection guide](https://docs.gaianet.ai/node-guide/customize#select-a-knowledge-base)
3. Configure using the recommended settings from the [node deployment guide](/node-deployment#recommended-gaianet-node-configuration)

### Customizing for Other DAOs

To generate a knowledge base for a different DAO, modify the `api_name` and `api_parameters` in the [boardroom_api_pipeline.yaml](https://github.com/raid-guild/gaianet-rag-api-pipeline/blob/main/config/boardroom_api_pipeline.yaml) file.